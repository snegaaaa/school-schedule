<!doctype html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</title>
  <link rel="stylesheet" th:href="@{/css/app.css}">
  <style>
    .kpi-grid{
      display:grid;
      grid-template-columns:repeat(6, 1fr);
      gap:12px;
      margin-top:14px;
    }
    @media (max-width: 1150px){ .kpi-grid{ grid-template-columns:repeat(3, 1fr);} }
    @media (max-width: 700px){ .kpi-grid{ grid-template-columns:repeat(2, 1fr);} }
    @media (max-width: 420px){ .kpi-grid{ grid-template-columns:1fr;} }

    .kpi-card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow:var(--shadow);
      padding:14px;
      display:flex;
      align-items:center;
      gap:12px;
      min-height:72px;
    }
    .kpi-ic{
      width:42px;
      height:42px;
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid rgba(13,110,253,.18);
      background:rgba(13,110,253,.08);
      font-size:20px;
      flex:0 0 auto;
    }
    .kpi-lbl{
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      margin:0 0 2px;
      letter-spacing:.2px;
    }
    .kpi-num{
      font-size:26px;
      font-weight:900;
      line-height:1;
      margin:0;
    }

    .bars { display:flex; gap:14px; align-items:flex-end; padding-top:10px; }
    .bar { width: 100%; }
    .bar .col { height: 140px; display:flex; align-items:flex-end; }
    .bar .fill { width:100%; border-radius: 10px; background: rgba(13, 110, 253, .18); border: 1px solid rgba(13, 110, 253, .28); }
    .bar .cap { margin-top:8px; text-align:center; font-size: 12px; color: var(--muted); }
    .bar .val { text-align:center; font-weight:900; margin-top:2px; }

    .topline { display:flex; gap:12px; flex-wrap:wrap; }
    .topbadge { padding:10px 12px; border-radius: 12px; background: rgba(13, 110, 253, .08); border: 1px solid rgba(13, 110, 253, .16); }
  </style>
</head>
<body>
<div class="container">

  <div class="topbar">
    <div class="brand">
      <a class="brand-title" th:href="@{/}">–®–∫–æ–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
      <p class="brand-sub">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
    </div>

    <div class="nav">
      <a th:href="@{/schedule}">üìÖ –ü–æ –¥–Ω—è–º</a>
      <a th:href="@{/schedule/week}">üóìÔ∏è –ù–µ–¥–µ–ª—è</a>
      <a class="active" th:href="@{/stats}">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
      <a th:href="@{/about}">‚ÑπÔ∏è –û–± –∞–≤—Ç–æ—Ä–µ</a>

      <span sec:authorize="hasRole('ADMIN')" class="inline">
        <a th:href="@{/classes}">üè´ –ö–ª–∞—Å—Å—ã</a>
        <a th:href="@{/setup}">üß© –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏</a>
        <a th:href="@{/admin/users}">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
      </span>
    </div>

    <div class="userbox">
      <div class="badge">üë§ <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span> <b sec:authentication="name">user</b></div>
      <form th:action="@{/logout}" method="post" style="margin:0;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        <button class="btn" type="submit">–í—ã–π—Ç–∏</button>
      </form>
    </div>
  </div>

  <div class="pagehead">
    <h1>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
    <p>–°–≤–æ–¥–∫–∞ –ø–æ –¥–∞–Ω–Ω—ã–º –∏ –Ω–∞–≥—Ä—É–∑–∫–µ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏.</p>
  </div>

  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-ic">üë•</div>
      <div>
        <div class="kpi-lbl">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
        <div class="kpi-num" th:text="${usersCount}">0</div>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-ic">üè´</div>
      <div>
        <div class="kpi-lbl">–ö–ª–∞—Å—Å—ã</div>
        <div class="kpi-num" th:text="${classesCount}">0</div>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-ic">üïí</div>
      <div>
        <div class="kpi-lbl">–°–ª–æ—Ç—ã –≤—Ä–µ–º–µ–Ω–∏</div>
        <div class="kpi-num" th:text="${timeSlotsCount}">0</div>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-ic">üìö</div>
      <div>
        <div class="kpi-lbl">–ü—Ä–µ–¥–º–µ—Ç—ã</div>
        <div class="kpi-num" th:text="${subjectsCount}">0</div>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-ic">üë©‚Äçüè´</div>
      <div>
        <div class="kpi-lbl">–£—á–∏—Ç–µ–ª—è</div>
        <div class="kpi-num" th:text="${teachersCount}">0</div>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-ic">üßæ</div>
      <div>
        <div class="kpi-lbl">–£—Ä–æ–∫–∏</div>
        <div class="kpi-num" th:text="${lessonsCount}">0</div>
      </div>
    </div>
  </div>

  <div class="grid" style="margin-top: 14px;">

    <div class="card">
      <div class="h2">–¢–æ–ø –ø–æ –Ω–∞–≥—Ä—É–∑–∫–µ</div>
      <div class="topline" style="margin-top: 10px;">
        <div class="topbadge">
          <div class="muted" style="font-size:12px;">–£—á–∏—Ç–µ–ª—å</div>
          <div style="font-weight:900;" th:text="${topTeacher.name}">‚Äî</div>
          <div class="muted" th:text="'–£—Ä–æ–∫–æ–≤: ' + ${topTeacher.count}">–£—Ä–æ–∫–æ–≤: 0</div>
        </div>
        <div class="topbadge">
          <div class="muted" style="font-size:12px;">–ö–∞–±–∏–Ω–µ—Ç</div>
          <div style="font-weight:900;" th:text="${topRoom.name}">‚Äî</div>
          <div class="muted" th:text="'–£—Ä–æ–∫–æ–≤: ' + ${topRoom.count}">–£—Ä–æ–∫–æ–≤: 0</div>
        </div>
        <div class="topbadge">
          <div class="muted" style="font-size:12px;">–ü—Ä–µ–¥–º–µ—Ç</div>
          <div style="font-weight:900;" th:text="${topSubject.name}">‚Äî</div>
          <div class="muted" th:text="'–£—Ä–æ–∫–æ–≤: ' + ${topSubject.count}">–£—Ä–æ–∫–æ–≤: 0</div>
        </div>
      </div>

      <hr class="hr">
      <div class="muted" style="font-size:12px;">
        –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span th:text="${#temporals.format(updatedAt, 'dd.MM.yyyy HH:mm')}">‚Äî</span>
      </div>
    </div>

    <div class="card">
      <div class="h2">–£—Ä–æ–∫–∏ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏</div>

      <div class="bars">
        <div class="bar" th:each="b : ${bars}">
          <div class="col">
            <div class="fill" th:style="'height:' + ${b.percent} + '%'"></div>
          </div>
          <div class="cap" th:text="${b.title}">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</div>
          <div class="val" th:text="${b.count}">0</div>
        </div>
      </div>
    </div>

  </div>

</div>
</body>
</html>
