<!doctype html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</title>
  <link rel="stylesheet" th:href="@{/css/app.css}">
  <style>
    .role-badge{ display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; border:1px solid var(--border); font-weight:800; font-size:12px; }
    .role-admin{ background: rgba(220,53,69,.06); border-color: rgba(220,53,69,.25); }
    .role-viewer{ background: rgba(13,110,253,.06); border-color: rgba(13,110,253,.25); }
    .pill-off{ opacity:.6; }
    .rowform{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .mini{ height:34px; padding:0 10px; }
    .chk{ display:flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid var(--border); border-radius:12px; background:#fff; }
  </style>
</head>
<body>
<div class="container">

  <th:block th:replace="~{fragments/topbar :: topbar('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏','users')}"></th:block>

  <div class="pagehead">
    <h1>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –∏ –¥–æ—Å—Ç—É–ø–æ–º.</p>
  </div>

  <div class="card" th:if="${error != null || ok != null}">
    <div class="alert alert-danger" th:if="${error == 'role'}">–ù–µ–≤–µ—Ä–Ω–∞—è —Ä–æ–ª—å.</div>
    <div class="alert alert-danger" th:if="${error == 'notFound'}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.</div>
    <div class="alert alert-warn" th:if="${error == 'selfDisable'}">–ù–µ–ª—å–∑—è –æ—Ç–∫–ª—é—á–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è.</div>
    <div class="alert alert-warn" th:if="${error == 'selfDemote'}">–ù–µ–ª—å–∑—è –ø–æ–Ω–∏–∑–∏—Ç—å —Å–≤–æ—é —Ä–æ–ª—å –Ω–∏–∂–µ ADMIN.</div>
    <div class="alert alert-success" th:if="${ok != null}">–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.</div>
  </div>

  <div class="card" style="margin-top:16px;">
    <div class="h2" style="margin-bottom:10px;">–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>

    <div class="muted" style="margin-bottom:12px;">
      –ì–∞–ª–æ—á–∫–∞ ‚Äú–ê–∫—Ç–∏–≤–µ–Ω‚Äù –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—Ö–æ–¥–∞.
    </div>

    <table class="table">
      <tr>
        <th style="width:70px;">ID</th>
        <th>–õ–æ–≥–∏–Ω</th>
        <th style="width:160px;">–†–æ–ª—å</th>
        <th style="width:120px;">–°—Ç–∞—Ç—É—Å</th>
        <th style="width:360px;">–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>

      <tr th:each="u : ${users}">
        <td th:text="${u.id}">1</td>
        <td><b th:text="${u.username}">admin</b></td>

        <td>
          <span class="role-badge" th:classappend="${u.role == 'ADMIN'} ? ' role-admin' : ' role-viewer'">
            <span th:text="${u.role == 'ADMIN'} ? 'üõ°Ô∏è ADMIN' : 'üëÅÔ∏è VIEWER'">ADMIN</span>
          </span>
        </td>

        <td>
          <span th:if="${u.enabled}" class="badge">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span>
          <span th:if="${!u.enabled}" class="badge pill-off">‚õî –û—Ç–∫–ª—é—á—ë–Ω</span>
        </td>

        <td>
          <form class="rowform" method="post" th:action="@{/admin/users/update}">
            <th:block th:replace="~{fragments/csrf :: csrf}"></th:block>
            <input type="hidden" name="id" th:value="${u.id}">

            <select class="input mini" name="role">
              <option value="VIEWER" th:selected="${u.role == 'VIEWER'}">VIEWER</option>
              <option value="ADMIN" th:selected="${u.role == 'ADMIN'}">ADMIN</option>
            </select>

            <label class="chk">
              <input type="checkbox" name="enabled" th:checked="${u.enabled}">
              <span>–ê–∫—Ç–∏–≤–µ–Ω</span>
            </label>

            <button class="btn mini" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </form>
        </td>
      </tr>
    </table>
  </div>

</div>
</body>
</html>
